<!DOCTYPE html>
<html>
	<head>
		<% include ../partials/head.ejs %>
		<script src="/app.js" charset="utf-8"></script>
	</head>
	<body>
		<nav>
			<div class="nav-wrapper teal lighten-2">
				<a href="#" onclick="sidebar()" class="sidenav-trigger show-on-large" data-target="slide_out"><i class="material-icons">menu</i></a>
				<div class="container center-align">
					<a href="/main" class="brand-logo right">Fuel Tracker</a>
				</div>
			</div>
			<ul class="sidenav" id="slide_out">
				<div class="teal lighten-2 gasIconContainer">
					<i class="material-icons gasIcon">local_gas_station</i>
				</div>
				<div class="sideNavButtonContainer">
					<li class="active sideNavButton"><a href="/main"><i class="material-icons">home</i>Home</a></li>
					<li class="active sideNavButton"><a href="/users/<%=currentUser.username%>"><i class="material-icons">account_box</i>Profile</a></li>
					<li class="active sideNavButton"><a href="/main/new"><i class="material-icons">add</i>New Data</a></li>
					<li class="active sideNavButton"><a href="#"><i class="material-icons">map</i>Maps</a></li>
					<form class="logout" action="/users?_method=DELETE" method="POST">
						<li class="active sideNavButton"><a href="#" onclick="logout()"><i class="material-icons">cancel</i>Log Out</a></li>
					</form>
				</div>
			</ul>
		</nav>
		<div class="row center container">
			<div class="container info col s5 m2 l2">
				Total Fuel Cost: <br>
				$<%=totalCost%>
			</div>
			<div class="container info col s5 m2 l2">
				Total Gallons: <br>
				<%=totalGal%>
			</div>
			<div class="container info col s5 m2 l2">
				Total Miles: <br>
				<% if (Data.length > 1) { %>
					<%=Data[Data.length - 1].odometer - Data[0].odometer%>
				<% } else { %>
					Not Enough Data
				<% } %>
			</div>
			<div class="container info col s5 m2 l2">
				Best MPG: <br>
				<%=bestMpg%>
			</div>
			<div class="container info col s5 m2 l2">
				Last MPG: <br>
				<%=lastMpg%>
			</div>
			<div class="container info col s5 m2 l2">
				Fuel logs: <br>
				<%=totalLogs%>
			</div>
		</div>
		<div class="container">
			<table class="container">
				<tr>
					<th>Index</th>
					<th>Odometer</th>
					<th>Fuel Type</th>
					<th>Gallons</th>
					<th>Total Cost</th>
					<th>Cost/Gal</th>
					<th>Location</th>
					<th>Dates</th>
					<th>Miles Per Gallon</th>
					<th>Brand</th>
				</tr>

				<% Data.forEach((ele, index) => { %>
					<% let milesPerGal = 0 %>

					<% if (index !== 0) { %>
						<% milesPerGal = (Data[index].odometer - Data[index - 1].odometer)/Data[index-1].gallons %>
					<% } %>

					<tr>
						<th><a href="main/<%=ele.id%>"><%=index%></a></th>
						<th><%=ele.odometer%></th>
						<th><%=ele.type%></th>
						<th><%=ele.gallons%></th>
						<th>$<%=ele.total%></th>
						<th>$<%=ele.pergal%></th>
						<th><%=ele.location%></th>
						<th><%=ele.date.toLocaleDateString()%></th>
						<th><%=Math.round(milesPerGal * 100) / 100%></th>
						<th><%=ele.brand%></th>
					</tr>
				<% }) %>
			</table>
		</div>
		<div class="row center container">
			<div class="container info col s5 m3 l3">
				Avg MPG: <br>
				<%=avgMpg%>
			</div>
			<div class="container info col s5 m3 l3">
				Avg Price/Gal: <br>
				$<%=avgPrice%>
			</div>
			<div class="container info col s5 m3 l3">
				Avg Fuel Up Cost: <br>
				$<%=avgFuelup%>
			</div>
			<div class="container info col s5 m3 l3">
				Avg Price/Mile: <br>
				$<%=avgPMile%>
			</div>
		</div>

		<div class="container row">
			<div class="container col s5 m6 l6 center">
				<div id="pie">Fuel Types</div>
			</div>
			<div id="brand"></div>
			<div id="line"></div>
		</div>
			<script type="text/javascript">
				pieChart(<%-JSON.stringify(chartData)%>)
				lineChart(<%-JSON.stringify(lineData)%>)
				brandChart(<%-JSON.stringify(brandData)%>)
			</script>
	</body>
</html>